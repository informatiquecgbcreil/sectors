{% extends "layout.html" %}
{% block body %}

<div class="stack">
  <div class="card">
    <div class="inline" style="justify-content:space-between;">
      <div>
        <h1>Ateliers (Pr√©sences)</h1>
        <p class="muted">Synchronis√©s depuis la base <strong>presence.db</strong> de ton app d‚Äô√©margement. Les responsables de secteur ne voient que les ateliers d√©j√† rattach√©s √† leurs projets.</p>
        <p class="muted">Chemin utilis√© : <code>{{ presence_db_path }}</code></p>
        <p class="muted">Si erreur <em>no such table \"participants\"</em> : tu pointes vers une DB vide/incorrecte (SQLite cr√©e un fichier vide si le chemin est faux).</p>
      </div>
      {% if can_manage %}
      <form method="POST" action="{{ url_for('ateliers.sync_ateliers') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button class="btn ok" type="submit">üîÑ Synchroniser</button>
      </form>
      {% endif %}
    </div>
  </div>

  <div class="card">
    <div class="tablewrap">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Titre</th>
            <th>Lieu</th>
            <th>Horaires</th>
            <th>Participants</th>
            <th>Rattach√© √†</th>
          </tr>
        </thead>
        <tbody>
          {% for a in ateliers %}
            <tr>
              <td><strong>{{ a.date }}</strong></td>
              <td>{{ a.titre }}</td>
              <td>{{ a.lieu or "-" }}</td>
              <td>{{ a.horaires or "-" }}</td>
              <td><span class="tag">{{ a.nb_participants or 0 }}</span></td>
              <td>
                {% set ps = linked_map.get(a.id, []) %}
                {% if ps and ps|length > 0 %}
                  <span class="muted">{{ ps|join(", ") }}</span>
                {% else %}
                  <span class="muted">‚Äî</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
          {% if ateliers|length == 0 %}
            <tr><td colspan="6" class="muted">Aucun atelier. Si tu viens de copier presence.db, clique sur Synchroniser.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

</div>

{% endblock %}
