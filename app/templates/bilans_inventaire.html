{% extends "layout.html" %}

{% block body %}
  {% if forbidden %}
    <div class="card">
      <h1>Bilans &amp; Stats ¬∑ Inventaire</h1>
      <p class="muted">Acc√®s r√©serv√© aux r√¥les finance/direction/responsable de secteur.</p>
    </div>
  {% else %}
    <div class="stack">
      <div class="card">
        <div class="inline" style="justify-content:space-between; flex-wrap:wrap; gap:10px;">
          <div>
            <div class="inline" style="gap:12px; flex-wrap:wrap; align-items:baseline;">
              <h1 style="margin:0;">Inventaire</h1>
              <form method="get" action="{{ url_for('bilans.inventaire') }}" class="inline" style="gap:8px;">
                <label for="year" class="muted">Exercice</label>
                <select id="year" name="year" onchange="this.form.submit()">
                  {% for y in years %}
                    <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
                  {% endfor %}
                </select>
                <noscript><button class="btn" type="submit">OK</button></noscript>
              </form>
            </div>
            <p class="muted">Vision patrimoine + qualit√© de saisie inventaire.</p>
          </div>
          <div class="inline" style="gap:8px; flex-wrap:wrap;">
            <a class="btn" href="{{ url_for('bilans.dashboard', year=year) }}">‚Üê Dashboard</a>
            <a class="btn" href="{{ url_for('bilans.qualite', year=year) }}">üßπ Qualit√© de gestion</a>
          </div>
        </div>
      </div>

      <div class="grid two">
        <div class="card">
          <h3>Nombre d'items</h3>
          <h2>{{ data.nb_items }}</h2>
          <p class="muted">Entr√©es inventaire (quantit√©s incluses).</p>
        </div>
        <div class="card">
          <h3>Valeur estim√©e</h3>
          <h2>{{ '%.2f'|format(data.valeur) }} ‚Ç¨</h2>
          <p class="muted">Somme valeur_unitaire √ó quantit√© (si renseign√©).</p>
        </div>
      </div>

      <div class="grid two">
        <div class="card">
          <h2>R√©partition par √©tat</h2>
          {% if data.repartition %}
            <div class="tablewrap">
              <table>
                <thead>
                  <tr><th>√âtat</th><th class="right">Nb</th></tr>
                </thead>
                <tbody>
                  {% for r in data.repartition %}
                    <tr>
                      <td>{{ r.etat }}</td>
                      <td class="right">{{ r.nb }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="muted">Aucune donn√©e.</p>
          {% endif %}
        </div>

        <div class="card">
          <h2>Qualit√© inventaire</h2>
          <ul>
            <li>Sans localisation : <strong>{{ data.qualite.sans_localisation }}</strong></li>
            <li>Sans n¬∞ de s√©rie : <strong>{{ data.qualite.sans_serie }}</strong></li>
          </ul>
          <p class="muted">Indicateurs d'aide : rien n'est bloquant.</p>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
